/*!
	flux.js by morriswmz
	---------------------------------------
	A simple library to play with particles.
	Not very fancy, but works like a charm :)
	I would be appreciated if you give credit
	to me when you use it or extend it.
	
	NOTE : NO render is included
*/
(function(){var b={};
function d(j,i,h){if(h){for(var g in h){i[g]=h[g];}for(var f in i){j[f]=i[f];}}else{for(var e in i){j[e]=i[e];}return j;}}function a(f,e){if(typeof(f)=="function"){d(f.prototype,e);
}else{d(f,e);}}function c(g,f){var e=g.prototype.constructor;if(typeof(f.constructor)=="function"){g.prototype=new f();g.prototype._super=f;g.prototype.constructor=e;
}else{g.prototype=f;g.prototype._super=f;g.prototype.constructor=e;}}b.geom={};b.geom.Point=(function(){function e(f,g){this.x=f||0;this.y=g||0;}e.distance=function(i,h){var g=i.x-h.x,f=i.y-h.y;
return Math.sqrt(g*g+f*f);};e.Interpolate=function(k,j,i){var h=j.x-k.x,g=j.y-k.y,f=k.x+h*i,l=k.y+g*i;return new e(f,l);};a(e,{clone:function(){return new e(this.x,this.y);
},equals:function(f){return(this.x==f.x&&this.y==f.y);},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);},normalize:function(){var f=this.length();
if(f>0){this.x/=f;this.y/=f;}}});return e;})();b.geom.Rectangle=(function(){function e(g,i,h,f){this.x=g;this.y=i;this.width=h;this.height=f;}a(e,{top:function(){return this.y;
},right:function(){return this.x+this.width;},bottom:function(){return this.y+this.height;},left:function(){return this.x;},contains:function(g,f){return(g>=this.x&&g<=this.x+this.width&&f>=this.y&&f<=this.y+this.height);
}});return e;})();b.Particle=function(){this.x=0;this.y=0;this.z=0;this.vx=0;this.vy=0;this.vz=0;this.ax=0;this.ay=0;this.az=0;this.lifespan=Number.MAX_VALUE;
this.age=0;this.properties=0;this.next=null;};b.ParticleManager=(function(e,f){function g(i){this.timeStep=i||1/30;this.activePool=new e();this.garbagePool=new e();
this.activeCount=0;this.garbageCount=0;this.fields=[];this.boundary=new f(-32768,-32768,65536,65536);}function h(q,p){var m=0,o,l,j=this,k=j.garbagePool;
if(k.next){o=k.next;k.next=o.next;o.next=null;o.age=0;o.ax=0;o.ay=0;o.az=0;o.lifespan=p;j.garbageCount--;}else{o=new e();o.age=0;o.lifespan=p;}for(m=1;
m<q;m++){if(k.next){l=k.next;k.next=l.next;l.next=o.next;o.next=l;l.age=0;l.ax=0;l.ay=0;l.az=0;l.lifespan=p;j.garbageCount--;}else{l=new e();l.next=o.next;
o.next=l;l.age=0;l.ax=0;l.ay=0;l.az=0;l.lifespan=p;}}j.activeCount+=q;return o;}a(g,{isActive:function(){return(this.activePool.next!=null);},particleList:function(){return this.activePool.next;
},update:function(o){var q=this,m=q.timeStep,n=q.activePool,r=q.garbagePool,p=n.next,j=n,l,k;while(p){p.age+=m;if(p.age>=p.lifespan||!q.boundary.contains(p.x,p.y)){l=p.next;
j.next=p.next;p.next=r.next;r.next=p;p.age=p.lifespan;p=l;q.garbageCount++;q.activeCount--;}else{p.x+=(p.vx+0.5*p.ax*m)*m;p.y+=(p.vy+0.5*p.ay*m)*m;p.z+=(p.vz+0.5*p.az*m)*m;
p.vx+=p.ax*m;p.vy+=p.ay*m;p.vz+=p.az*m;p.ax=0;p.ay=0;p.az=0;}if(p){j=p;p=p.next;}}for(k=0;k<q.fields.length;k++){q.fields[k].apply(n.next);}if(o!=null){o.call(this,activePool.next);
}},generate:function(l,o,m,k){if(!l){throw new Error("No emitter specified");}o=o||0;m=m||Number.MAX_VALUE;k=k||0;var i=h.call(this,o,m),j=l.initParticles(i);
j.next=this.activePool.next;this.activePool.next=i;},clear:function(){var j=this,i=j.activePool,k=j.garbagePool,m=i.next,l;while(m){i.next=m.next;l=m.next;
m.next=k.next;k.next=m;m=l;j.garbageCount++;j.activeCount--;}}});return g;})(b.Particle,b.geom.Rectangle);b.emitters={};b.emitters.EmissionDirection={INSIDE:0,OUTSIDE:1,BOTH_SIDE:2};
b.emitters.AbstractEmitter=function(e,f){this.velocityBase=e||0;this.velocityVariance=f||0;};b.emitters.PointEmitter=(function(){function e(g){var f=this;
f.centerX=g.centerX||0;f.centerY=g.centerY||0;f._super(g.velocityBase,g.velocityVariance);if(g.angleStart!=undefined&&g.angleStop!=undefined){f.angleStart=g.angleStart;
f.angleStop=g.angleStop;if(f.angleStart<f.angleStop){var h=f.angleStart;f.angleStart=f.angleStop;f.angleStop=h;}}else{f.angleStart=0;f.angleStop=Math.PI*2;
}}c(e,b.emitters.AbstractEmitter);a(e,{setCenter:function(f,g){this.centerX=f;this.centerY=g;},initParticles:function(i){var f=this,k=i,j,h,l,g=f.angleStop-f.angleStart;
while(k){k.x=f.centerX;k.y=f.centerY;h=f.velocityBase+(Math.random()-0.5)*f.velocityVariance;l=f.angleStart+Math.random()*g;k.vx=h*Math.cos(l);k.vy=h*Math.sin(l);
j=k;k=k.next;}return j;}});return e;})();b.emitters.CircularEmitter=(function(f){function e(h){var g=this;g.centerX=h.centerX||0;g.centerY=h.centerY||0;
g.radius=h.radius||0;if(g.radius<0){g.radius=0;}g._super(h.velocityBase,h.velocityVariance);if(h.angleStart!=undefined&&h.angleStop!=undefined){g.angleStart=h.angleStart;
g.angleStop=h.angleStop;if(g.angleStart<g.angleStop){var i=g.angleStart;g.angleStart=g.angleStop;g.angleStop=i;}}else{g.angleStart=0;g.angleStop=Math.PI*2;
}g.direction=h.direction||f.OUTSIDE;}c(e,b.emitters.AbstractEmitter);a(e,{setCircle:function(g,i,h){this.centerX=g;this.centerY=i;this.radius=h;},initParticles:function(o){var p=this,n=o,h,i,l,j=p.angleStop-p.angleStart,m,k,g=(p.direction==f.INSIDE)?-1:1;
switch(p.direction){case f.BOTH_SIDE:while(n){g=Math.random()>0.5?1:-1;l=p.angleStart+Math.random()*j;m=Math.sin(l);k=Math.cos(l);n.x=p.centerX+p.radius*k;
n.y=p.centerY+p.radius*m;i=p.velocityBase+(Math.random()-0.5)*p.velocityVariance;n.vx=i*k*g;n.vy=i*m*g;h=n;n=n.next;}break;default:while(n){l=p.angleStart+Math.random()*j;
m=Math.sin(l);k=Math.cos(l);n.x=p.centerX+p.radius*k;n.y=p.centerY+p.radius*m;i=p.velocityBase+(Math.random()-0.5)*p.velocityVariance;n.vx=i*k*g;n.vy=i*m*g;
h=n;n=n.next;}}return h;}});return e;})(b.emitters.EmissionDirection);b.emitters.PathEmitter=(function(e,f){function g(h){this._super(h.velocityBase,h.velocityVariance);
dir=h.direction||e.BOTH_SIDE;this.setPathFromArray(h.path);}c(g,b.emitters.AbstractEmitter);a(g,{setPathFromArray:function(m){var q=this,k,h=m.length;q._path=[];
var r=q._path;for(k=0;k<h;k+=2){r.push(new f(m[k],m[k+1]));}q._cumulativeNormalizedLengths=[];q._normalizedLengths=[];q._lengths=[];var o,l=q._cumulativeNormalizedLengths,p=q._normalizedLengths,j=q._lengths;
h=r.length;o=0;for(k=0;k<h-1;k++){p[k]=f.distance(r[k],r[k+1]);j[k]=p[k];o+=p[k];l.push(o);}h=l.length;for(k=0;k<h;k++){l[k]/=o;p[k]/=o;}},initParticles:function(v){var w=this,t=v,j,k,h,s,i,r,q,p,o,x,u,m;
while(t){s=0;i=w._cumulativeNormalizedLengths.length;h=Math.random();while(s<i&&h>w._cumulativeNormalizedLengths[s]){s++;}if(s>0){h-=w._cumulativeNormalizedLengths[s-1];
}m=w._lengths[s];h/=w._normalizedLengths[s];r=w._path[s].x;q=w._path[s].y;p=w._path[s+1].x;o=w._path[s+1].y;x=p-r;u=o-q;t.x=r+h*x;t.y=q+h*u;k=(w.velocityBase+(Math.random()-0.5)*w.velocityVariance);
k=(Math.random()>0.5)?k:-k;t.vx=-k*u/m;t.vy=k*x/m;j=t;t=t.next;}return j;}});return g;})(b.emitters.EmissionDirection,b.geom.Point);b.fields={};b.fields.GravitationField=(function(){function e(h,g,f){this.gx=h||0;
this.gy=g||0;this.gz=f||0;}a(e,{apply:function(g){var f=g;while(f){f.ax+=this.gx;f.ay+=this.gy;f=f.next;}}});return e;})();b.fields.RandomWalkerField=(function(){function e(f){this.angleRange=f||Math.PI/12;
}a(e,{apply:function(l){var i=l,h,k,j,g,f;while(i){h=this.angleRange*(Math.random()-0.5);k=Math.cos(h);j=Math.sin(h);g=i.vx;f=i.vy;i.vx=g*k-f*j;i.vy=g*j+f*k;
i=i.next;}}});return e;})();b.fields.ResistanceField=(function(){function e(f){this.k=f||0;if(this.k<0){this.k=0;}}a(e,{apply:function(g){var f=g;while(f){f.ax+=-this.k*f.vx;
f.ay+=-this.k*f.vy;f=f.next;}}});return e;})();b.fields.RepulsionField=(function(){function e(f,i,h,g){this.centerX=f||0;this.centerY=i||0;this.centerZ=h||0;
this._strength=g||0;this._effectiveRadius=g;}a(e,{strength:function(f){if(f){if(f<0){f=0;}this._strength=f;this._effectiveRadius=this._strength;}else{return this._strength;
}},apply:function(m){var i=this,k=m,h,g,j,l,f;while(k){h=k.x-i.centerX;g=k.y-i.centerY;if(h>i._effectiveRadius||h<-i._effectiveRadius||g>i._effectiveRadius||g<-i._effectiveRadius){k=k.next;
}else{j=h*h+g*g+1;l=Math.sqrt(j);f=i._strength/j;k.ax+=f*h;k.ay+=f*g;k=k.next;}}}});return e;})();b.fields.AttractionField=(function(){function e(f,i,h,g){this.centerX=f||0;
this.centerY=i||0;this.centerZ=h||0;this._strength=g||0;this._effectiveRadius=Math.sqrt(g)*2;}a(e,{strength:function(f){if(f){if(f<0){f=0;}this._strength=f;
this._effectiveRadius=Math.sqrt(f)*2;}else{return this._strength;}},apply:function(m){var i=this,k=m,h,g,j,l,f;while(k){h=i.centerX-k.x;g=i.centerY-k.y;
if(h>i._effectiveRadius||h<-i._effectiveRadius||g>i._effectiveRadius||g<-i._effectiveRadius){k=k.next;}else{j=h*h+g*g+1;l=Math.sqrt(j);f=i._strength/j/l;
k.ax+=f*h;k.ay+=f*g;k=k.next;}}}});return e;})();window.flux=b;})();